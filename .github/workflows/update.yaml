name: Manage Secrets

on:
  workflow_dispatch:
    inputs:
      secret_type:
        description: "Select Secret Type"
        required: true
        type: choice
        options:
          - Environment secrets
          - Repository secrets
      action_type:
        description: "Select Action Type"
        required: true
        type: choice
        options:
          - Add
          - Modify
      repo_owner:
        description: "Enter Repository Owner"
        required: true
        type: string
      repo_name:
        description: "Enter Repository Name"
        required: true
        type: string
      environment_name:
        description: "Enter Environment Name (required only for Environment secrets)"
        required: false
        type: string
      secret_key:
        description: "Enter Secret Key"
        required: true
        type: string
      secret_value:
        description: "Enter Secret Value"
        required: true
        type: string

jobs:
  manage-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: Install GitHub CLI
        run: sudo apt-get update && sudo apt-get install -y gh

      - name: Authenticate GitHub CLI
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          echo "Authenticating GitHub CLI..."
          gh auth status || echo "${{ secrets.PERSONAL_ACCESS_TOKEN }}" | gh auth login --with-token

      - name: Manage Secrets
        env:
          SECRET_TYPE: ${{ github.event.inputs.secret_type }}
          ACTION_TYPE: ${{ github.event.inputs.action_type }}
          REPO_OWNER: ${{ github.event.inputs.repo_owner }}
          REPO_NAME: ${{ github.event.inputs.repo_name }}
          ENV_NAME: ${{ github.event.inputs.environment_name }}
          SECRET_KEY: ${{ github.event.inputs.secret_key }}
          SECRET_VALUE: ${{ github.event.inputs.secret_value }}
          GH_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          if [[ "$SECRET_TYPE" == "Environment secrets" ]]; then
            if [[ -z "$ENV_NAME" ]]; then
              echo "Environment Name is required for Environment secrets."
              exit 1
            fi

            if [[ "$ACTION_TYPE" == "Add" ]]; then
              echo "Adding Environment Secret: $SECRET_KEY"
              echo "$SECRET_VALUE" | gh secret set $SECRET_KEY \
                --body - \
                --repo "$REPO_OWNER/$REPO_NAME" \
                --env "$ENV_NAME"
            elif [[ "$ACTION_TYPE" == "Modify" ]]; then
              echo "Modifying Environment Secret: $SECRET_KEY"
              echo "$SECRET_VALUE" | gh secret set $SECRET_KEY \
                --body - \
                --repo "$REPO_OWNER/$REPO_NAME" \
                --env "$ENV_NAME"
            fi
          elif [[ "$SECRET_TYPE" == "Repository secrets" ]]; then
            if [[ "$ACTION_TYPE" == "Add" ]]; then
              echo "Adding Repository Secret: $SECRET_KEY"
              echo "$SECRET_VALUE" | gh secret set $SECRET_KEY \
                --body - \
                --repo "$REPO_OWNER/$REPO_NAME"
            elif [[ "$ACTION_TYPE" == "Modify" ]]; then
              echo "Modifying Repository Secret: $SECRET_KEY"
              echo "$SECRET_VALUE" | gh secret set $SECRET_KEY \
                --body - \
                --repo "$REPO_OWNER/$REPO_NAME"
            fi
          else
            echo "Invalid Secret Type Selected."
            exit 1
          fi
